<?php
//Mime Types
//http://www.sitepoint.com/web-foundations/mime-types-summary-list/
//http://www.sitepoint.com/web-foundations/mime-types-complete-list/
class Upload {
	
  protected $_uploaded = array();
  protected $_destination;
  protected $_max = 10485760;
  protected $_messages = array();
  protected $_control_messages = 0;
  protected $_permitted = array('image/gif',
								'image/jpeg',
								'image/pjpeg',
								'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
								'application/msword',
								'application/pdf',
							    'application/mp21',
								'video/mp4',
								'audio/mp4',
								'application/mp4',
								'application/vnd.mophun.certificate',
								'video/mpeg',
								'audio/mpeg',
								'audio/mp3',
								'text/html',
								'application/vnd.ms-excel',
								'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
								'application/msword',
								'application/vnd.openxmlformats-officedocument.wordprocessingml.template',
								'application/vnd.ms-word.document.macroEnabled.12',
								'application/vnd.ms-word.template.macroEnabled.12',
								'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
								'application/vnd.openxmlformats-officedocument.spreadsheetml.template',
								'application/vnd.openxmlformats-officedocument.presentationml.template',
								'application/vnd.openxmlformats-officedocument.presentationml.slideshow',
								'application/vnd.openxmlformats-officedocument.presentationml.presentation',
								'application/vnd.openxmlformats-officedocument.presentationml.slide',
								'application/vnd.openxmlformats-officedocument.wordprocessingml.template',
								'application/vnd.ms-excel.addin.macroEnabled.12',
								'application/vnd.ms-excel.sheet.binary.macroEnabled.12',
								 'application/vnd.lotus-1-2-3',
								 'text/vnd.in3d.3dml',
								 'image/x-3ds',
								 'video/3gpp2',
								 'video/3gpp',
								 'application/x-7z-compressed',
								 'application/x-authorware-bin',
								 'audio/x-aac',
								 'application/x-authorware-map',
								 'application/x-authorware-seg',
								 'application/x-abiword',
								 'application/pkix-attr-cert',
								 'application/vnd.americandynamics.acc',
								 'application/x-ace-compressed',
								 'application/vnd.acucobol',
								 'application/vnd.acucorp',
								 'audio/adpcm',
								 'application/vnd.audiograph',
								 'application/x-font-type1',
								 'application/vnd.ibm.modcap',
								 'application/vnd.ahead.space',
								 'application/postscript',
								 'audio/x-aiff',
								 'audio/x-aiff',
								 'audio/x-aiff',
								 'application/vnd.adobe.air-application-installer-package+zip',
								 'application/vnd.dvb.ait',
								 'application/vnd.amiga.ami',
								 'application/vnd.android.package-archive',
								 'text/cache-manifest',
								 'application/x-ms-application',
								 'application/vnd.lotus-approach',
								 'application/x-freearc',
								 'application/pgp-signature',
								 'video/x-ms-asf',
								 'text/x-asm',
								 'application/vnd.accpac.simply.aso',
								 'video/x-ms-asf',
								 'application/vnd.acucorp',
								 'application/atom+xml',
								 'application/atomcat+xml',
								 'application/atomsvc+xml',
								 'application/vnd.antix.game-component',
								 'audio/basic',
								 'video/x-msvideo',
								 'application/applixware',
								 'application/vnd.airzip.filesecure.azf',
								 'application/vnd.airzip.filesecure.azs',
								 'application/vnd.amazon.ebook',
								 'application/x-msdownload',
								 'application/x-bcpio',
								 'application/x-font-bdf',
								 'application/vnd.syncml.dm+wbxml',
								 'application/vnd.realvnc.bed',
								 'application/vnd.fujitsu.oasysprs',
								 'application/octet-stream',
								 'application/x-blorb',
								 'application/x-blorb',
								 'application/vnd.bmi',
								 'image/x-ms-bmp',
								 'application/vnd.framemaker',
								 'application/vnd.previewsystems.box',
								 'application/x-bzip2',
								 'application/octet-stream',
								 'image/prs.btif',
								 'application/octet-stream',
								 'application/x-bzip',
								 'application/x-bzip2',
								 'text/x-c',
								 'application/vnd.cluetrust.cartomobile-config',
								 'application/vnd.cluetrust.cartomobile-config-pkg',
								 'application/vnd.clonk.c4group',
								 'application/vnd.clonk.c4group',
								 'application/vnd.clonk.c4group',
								 'application/vnd.clonk.c4group',
								 'application/vnd.clonk.c4group',
								 'application/vnd.ms-cab-compressed',
								 'audio/x-caf',
								 'application/vnd.tcpdump.pcap',
								 'application/vnd.curl.car',
								 'application/vnd.ms-pki.seccat',
								 'application/x-cbr',
								 'application/x-cbr',
								 'application/x-cbr',
								 'application/x-cbr',
								 'application/x-cbr',
								 'text/x-c',
								 'application/x-director',
								 'application/ccxml+xml',
								 'application/vnd.contact.cmsg',
								 'application/x-netcdf',
								 'application/vnd.mediastation.cdkey',
								 'application/cdmi-capability',
								 'application/cdmi-container',
								 'application/cdmi-domain',
								 'application/cdmi-object',
								 'application/cdmi-queue',
								 'chemical/x-cdx',
								 'application/vnd.chemdraw+xml',
								 'application/vnd.cinderella',
								 'application/pkix-cert',
								 'application/x-cfs-compressed',
								 'image/cgm',
								 'application/x-chat',
								 'application/vnd.ms-htmlhelp',
								 'application/vnd.kde.kchart',
								 'chemical/x-cif',
								 'application/vnd.anser-web-certificate-issue-initiation',
								 'application/vnd.ms-artgalry',
								 'application/vnd.claymore',
								 'application/java-vm',
								 'application/vnd.crick.clicker.keyboard',
								 'application/vnd.crick.clicker.palette',
								 'application/vnd.crick.clicker.template',
								 'application/vnd.crick.clicker.wordbank',
								 'application/vnd.crick.clicker',
								 'application/x-msclip',
								 'application/vnd.cosmocaller',
								 'chemical/x-cmdf',
								 'chemical/x-cml',
								 'application/vnd.yellowriver-custom-menu',
								 'image/x-cmx',
								 'application/vnd.rim.cod',
								 'application/x-msdownload',
								 'text/plain',
								 'application/x-cpio',
								 'text/x-c',
								 'application/mac-compactpro',
								 'application/x-mscardfile',
								 'application/pkix-crl',
								 'application/x-x509-ca-cert',
								 'application/x-chrome-extension',
								 'application/vnd.rig.cryptonote',
								 'application/x-csh',
								 'chemical/x-csml',
								 'application/vnd.commonspace',
								 'text/css',
								 'application/x-director',
								 'text/csv',
								 'application/cu-seeme',
								 'text/vnd.curl',
								 'application/prs.cww',
								 'application/x-director',
								 'text/x-c',
								 'model/vnd.collada+xml',
								 'application/vnd.mobius.daf',
								 'application/vnd.dart',
								 'application/vnd.fdsn.seed',
								 'application/davmount+xml',
								 'application/docbook+xml',
								 'application/x-director',
								 'text/vnd.curl.dcurl',
								 'application/vnd.oma.dd2+xml',
								 'application/vnd.fujixerox.ddd',
								 'application/x-debian-package',
								 'text/plain',
								 'application/octet-stream',
								 'application/x-x509-ca-cert',
								 'application/vnd.dreamfactory',
								 'application/x-dgc-compressed',
								 'text/x-c',
								 'application/x-director',
								 'application/vnd.mobius.dis',
								 'application/octet-stream',
								 'application/octet-stream',
								 'image/vnd.djvu',
								 'image/vnd.djvu',
								 'application/x-msdownload',
								 'application/x-apple-diskimage',
								 'application/vnd.tcpdump.pcap',
								 'application/octet-stream',
								 'application/vnd.dna',
								 'application/msword',
								 'application/vnd.ms-word.document.macroenabled.12',
								 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
								 'application/msword',
								 'application/vnd.ms-word.template.macroenabled.12',
								 'application/vnd.openxmlformats-officedocument.wordprocessingml.template',
								 'application/vnd.osgi.dp',
								 'application/vnd.dpgraph',
								 'audio/vnd.dra',
								 'text/prs.lines.tag',
								 'application/dssc+der',
								 'application/x-dtbook+xml',
								 'application/xml-dtd',
								 'audio/vnd.dts',
								 'audio/vnd.dts.hd',
								 'application/octet-stream',
								 'video/vnd.dvb.file',
								 'application/x-dvi',
								 'model/vnd.dwf',
								 'image/vnd.dwg',
								 'image/vnd.dxf',
								 'application/vnd.spotfire.dxp',
								 'application/x-director',
								 'audio/vnd.nuera.ecelp4800',
								 'audio/vnd.nuera.ecelp7470',
								 'audio/vnd.nuera.ecelp9600',
								 'application/ecmascript',
								 'application/vnd.novadigm.edm',
								 'application/vnd.novadigm.edx',
								 'application/vnd.picsel',
								 'application/vnd.pg.osasli',
								 'application/octet-stream',
								 'application/x-msmetafile',
								 'message/rfc822',
								 'application/emma+xml',
								 'application/x-msmetafile',
								 'audio/vnd.digital-winds',
								 'application/vnd.ms-fontobject',
								 'application/postscript',
								 'application/epub+zip',
								 'application/vnd.eszigno3+xml',
								 'application/vnd.osgi.subsystem',
								 'application/vnd.epson.esf',
								 'application/vnd.eszigno3+xml',
								 'text/x-setext',
								 'application/x-eva',
								 'text/event-stream',
								 'application/x-envoy',
								 'application/x-msdownload',
								 'application/exi',
								 'application/vnd.novadigm.ext',
								 'application/andrew-inset',
								 'application/vnd.ezpix-album',
								 'application/vnd.ezpix-package',
								 'text/x-fortran',
								 'video/x-f4v',
								 'text/x-fortran',
								 'text/x-fortran',
								 'image/vnd.fastbidsheet',
								 'application/vnd.adobe.formscentral.fcdt',
								 'application/vnd.isac.fcs',
								 'application/vnd.fdf',
								 'application/vnd.denovo.fcselayout-link',
								 'application/vnd.fujitsu.oasysgp',
								 'application/x-director',
								 'image/x-freehand',
								 'image/x-freehand',
								 'image/x-freehand',
								 'image/x-freehand',
								 'image/x-freehand',
								 'application/x-xfig',
								 'audio/flac',
								 'video/x-fli',
								 'application/vnd.micrografx.flo',
								 'video/x-flv',
								 'application/vnd.kde.kivio',
								 'text/vnd.fmi.flexstor',
								 'text/vnd.fly',
								 'application/vnd.framemaker',
								 'application/vnd.frogans.fnc',
								 'text/x-fortran',
								 'image/vnd.fpx',
								 'application/vnd.framemaker',
								 'application/vnd.fsc.weblaunch',
								 'image/vnd.fst',
								 'application/vnd.fluxtime.clip',
								 'application/vnd.anser-web-funds-transfer-initiation',
								 'video/vnd.fvt',
								 'application/vnd.adobe.fxp',
								 'application/vnd.adobe.fxp',
								 'application/vnd.fuzzysheet',
								 'application/vnd.geoplan',
								 'image/g3fax',
								 'application/vnd.geospace',
								 'application/vnd.groove-account',
								 'application/x-tads',
								 'application/rpki-ghostbusters',
								 'application/x-gca-compressed',
								 'model/vnd.gdl',
								 'application/vnd.dynageo',
								 'application/vnd.geometry-explorer',
								 'application/vnd.geogebra.file',
								 'application/vnd.geogebra.tool',
								 'application/vnd.groove-help',
								 'image/gif',
								 'application/vnd.groove-identity-message',
								 'application/gml+xml',
								 'application/vnd.gmx',
								 'application/x-gnumeric',
								 'application/vnd.flographit',
								 'application/gpx+xml',
								 'application/vnd.grafeq',
								 'application/vnd.grafeq',
								 'application/srgs',
								 'application/x-gramps-xml',
								 'application/vnd.geometry-explorer',
								 'application/vnd.groove-injector',
								 'application/srgs+xml',
								 'application/x-font-ghostscript',
								 'application/x-gtar',
								 'application/vnd.groove-tool-message',
								 'model/vnd.gtw',
								 'text/vnd.graphviz',
								 'application/gxf',
								 'application/vnd.geonext',
								 'text/x-c',
								 'video/h261',
								 'video/h263',
								 'video/h264',
								 'application/vnd.hal+xml',
								 'application/vnd.hbci',
								 'application/x-hdf',
								 'text/x-c',
								 'application/winhlp',
								 'application/vnd.hp-hpgl',
								 'application/vnd.hp-hpid',
								 'application/vnd.hp-hps',
								 'application/mac-binhex40',
								 'text/x-component',
								 'application/vnd.kenameaapp',
								 'text/html',
								 'text/html',
								 'application/vnd.yamaha.hv-dic',
								 'application/vnd.yamaha.hv-voice',
								 'application/vnd.yamaha.hv-script',
								 'application/vnd.intergeo',
								 'application/vnd.iccprofile',
								 'x-conference/x-cooltalk',
								 'application/vnd.iccprofile',
								 'image/x-icon',
								 'text/calendar',
								 'image/ief',
								 'text/calendar',
								 'application/vnd.shana.informed.formdata',
								 'model/iges',
								 'application/vnd.igloader',
								 'application/vnd.insors.igm',
								 'model/iges',
								 'application/vnd.micrografx.igx',
								 'application/vnd.shana.informed.interchange',
								 'application/vnd.accpac.simply.imp',
								 'application/vnd.ms-ims',
								 'text/plain',
								 'application/inkml+xml',
								 'application/inkml+xml',
								 'application/x-install-instructions',
								 'application/vnd.astraea-software.iota',
								 'application/ipfix',
								 'application/vnd.shana.informed.package',
								 'application/vnd.ibm.rights-management',
								 'application/vnd.irepository.package+xml',
								 'application/x-iso9660-image',
								 'application/vnd.shana.informed.formtemplate',
								 'application/vnd.immervision-ivp',
								 'application/vnd.immervision-ivu',
								 'text/vnd.sun.j2me.app-descriptor',
								 'application/vnd.jam',
								 'application/java-archive',
								 'text/x-java-source',
								 'application/vnd.jisp',
								 'application/vnd.hp-jlyt',
								 'application/x-java-jnlp-file',
								 'application/vnd.joost.joda-archive',
								 'image/jpeg',
								 'image/jpeg',
								 'image/jpeg',
								 'video/jpm',
								 'video/jpeg',
								 'video/jpm',
								 'application/javascript',
								 'application/json',
								 'application/jsonml+json',
								 'audio/midi',
								 'application/vnd.kde.karbon',
								 'application/vnd.kde.kformula',
								 'application/vnd.kidspiration',
								 'application/vnd.google-earth.kml+xml',
								 'application/vnd.google-earth.kmz',
								 'application/vnd.kinar',
								 'application/vnd.kinar',
								 'application/vnd.kde.kontour',
								 'application/vnd.kde.kpresenter',
								 'application/vnd.kde.kpresenter',
								 'application/vnd.ds-keypoint',
								 'application/vnd.kde.kspread',
								 'application/vnd.kahootz',
								 'image/ktx',
								 'application/vnd.kahootz',
								 'application/vnd.kde.kword',
								 'application/vnd.kde.kword',
								 'application/vnd.las.las+xml',
								 'application/x-latex',
								 'application/vnd.llamagraphics.life-balance.desktop',
								 'application/vnd.llamagraphics.life-balance.exchange+xml',
								 'application/vnd.hhe.lesson-player',
								 'application/x-lzh-compressed',
								 'application/vnd.route66.link66+xml',
								 'text/plain',
								 'application/vnd.ibm.modcap',
								 'application/vnd.ibm.modcap',
								 'application/x-ms-shortcut',
								 'text/plain',
								 'application/lost+xml',
								 'application/octet-stream',
								 'application/vnd.ms-lrm',
								 'application/vnd.frogans.ltf',
								 'text/x-lua',
								 'application/x-lua-bytecode',
								 'audio/vnd.lucent.voice',
								 'application/vnd.lotus-wordpro',
								 'application/x-lzh-compressed',
								 'application/x-msmediaview',
								 'application/x-msmediaview',
								 'video/mpeg',
								 'application/mp21',
								 'audio/mpeg',
								 'video/mpeg',
								 'audio/mpeg',
								 'audio/x-mpegurl',
								 'application/x-mpegURL',
								 'audio/mp4',
								 'application/mp4',
								 'video/vnd.mpegurl',
								 'video/x-m4v',
								 'application/mathematica',
								 'application/mads+xml',
								 'application/vnd.ecowin.chart',
								 'application/vnd.framemaker',
								 'text/troff',
								 'text/cache-manifest',
								 'application/octet-stream',
								 'text/x-markdown',
								 'application/mathml+xml',
								 'application/mathematica',
								 'application/vnd.mobius.mbk',
								 'application/mbox',
								 'application/vnd.medcalcdata',
								 'application/vnd.mcd',
								 'text/vnd.curl.mcurl',
								 'text/x-markdown',
								 'application/x-msaccess',
								 'image/vnd.ms-modi',
								 'text/troff',
								 'model/mesh',
								 'application/metalink4+xml',
								 'application/metalink+xml',
								 'application/mets+xml',
								 'application/vnd.mfmp',
								 'application/rpki-manifest',
								 'application/vnd.osgeo.mapguide.package',
								 'application/vnd.proteus.magazine',
								 'audio/midi',
								 'audio/midi',
								 'application/x-mie',
								 'application/vnd.mif',
								 'message/rfc822',
								 'video/mj2',
								 'video/mj2',
								 'video/x-matroska',
								 'audio/x-matroska',
								 'text/x-markdown',
								 'video/x-matroska',
								 'video/x-matroska',
								 'application/vnd.dolby.mlp',
								 'application/vnd.chipnuts.karaoke-mmd',
								 'application/vnd.smaf',
								 'image/vnd.fujixerox.edmics-mmr',
								 'video/x-mng',
								 'application/x-msmoney',
								 'application/x-mobipocket-ebook',
								 'application/mods+xml',
								 'video/quicktime',
								 'video/x-sgi-movie',
								 'audio/mpeg',
								 'application/mp21',
								 'audio/mpeg',
								 'audio/mpeg',
								 'video/mp4',
								 'audio/mp4',
								 'application/mp4',
								 'video/mp4',
								 'application/vnd.mophun.certificate',
								 'video/mpeg',
								 'video/mpeg',
								 'video/mpeg',
								 'video/mp4',
								 'audio/mpeg',
								 'application/vnd.apple.installer+xml',
								 'application/vnd.blueice.multipass',
								 'application/vnd.mophun.application',
								 'application/vnd.ms-project',
								 'application/vnd.ms-project',
								 'application/vnd.ibm.minipay',
								 'application/vnd.mobius.mqy',
								 'application/marc',
								 'application/marcxml+xml',
								 'text/troff',
								 'application/mediaservercontrol+xml',
								 'application/vnd.fdsn.mseed',
								 'application/vnd.mseq',
								 'application/vnd.epson.msf',
								 'model/mesh',
								 'application/x-msdownload',
								 'application/vnd.mobius.msl',
								 'application/vnd.muvee.style',
								 'model/vnd.mts',
								 'application/vnd.musician',
								 'application/vnd.recordare.musicxml+xml',
								 'application/x-msmediaview',
								 'application/vnd.mfer',
								 'application/mxf',
								 'application/vnd.recordare.musicxml',
								 'application/xv+xml',
								 'application/vnd.triscape.mxs',
								 'video/vnd.mpegurl',
								 'application/vnd.nokia.n-gage.symbian.install',
								 'text/n3',
								 'application/mathematica',
								 'application/vnd.wolfram.player',
								 'application/x-netcdf',
								 'application/x-dtbncx+xml',
								 'text/x-nfo',
								 'application/vnd.nokia.n-gage.data',
								 'application/vnd.nitf',
								 'application/vnd.neurolanguage.nlu',
								 'application/vnd.enliven',
								 'application/vnd.noblenet-directory',
								 'application/vnd.noblenet-sealer',
								 'application/vnd.noblenet-web',
								 'image/vnd.net-fpx',
								 'application/x-conference',
								 'application/vnd.lotus-notes',
								 'application/vnd.nitf',
								 'application/x-nzb',
								 'application/vnd.fujitsu.oasys2',
								 'application/vnd.fujitsu.oasys3',
								 'application/vnd.fujitsu.oasys',
								 'application/x-msbinder',
								 'application/x-tgif',
								 'application/oda',
								 'application/vnd.oasis.opendocument.database',
								 'application/vnd.oasis.opendocument.chart',
								 'application/vnd.oasis.opendocument.formula',
								 'application/vnd.oasis.opendocument.formula-template',
								 'application/vnd.oasis.opendocument.graphics',
								 'application/vnd.oasis.opendocument.image',
								 'application/vnd.oasis.opendocument.text-master',
								 'application/vnd.oasis.opendocument.presentation',
								 'application/vnd.oasis.opendocument.spreadsheet',
								 'application/vnd.oasis.opendocument.text',
								 'audio/ogg',
								 'audio/ogg',
								 'video/ogg',
								 'application/ogg',
								 'application/omdoc+xml',
								 'application/onenote',
								 'application/onenote',
								 'application/onenote',
								 'application/onenote',
								 'application/oebps-package+xml',
								 'text/x-opml',
								 'application/vnd.palm',
								 'application/vnd.lotus-organizer',
								 'application/vnd.yamaha.openscoreformat',
								 'application/vnd.yamaha.openscoreformat.osfpvg+xml',
								 'application/vnd.oasis.opendocument.chart-template',
								 'font/opentype',
								 'application/vnd.oasis.opendocument.graphics-template',
								 'application/vnd.oasis.opendocument.text-web',
								 'application/vnd.oasis.opendocument.image-template',
								 'application/vnd.oasis.opendocument.presentation-template',
								 'application/vnd.oasis.opendocument.spreadsheet-template',
								 'application/vnd.oasis.opendocument.text-template',
								 'application/oxps',
								 'application/vnd.openofficeorg.extension',
								 'text/x-pascal',
								 'application/pkcs10',
								 'application/x-pkcs12',
								 'application/x-pkcs7-certificates',
								 'application/pkcs7-mime',
								 'application/pkcs7-mime',
								 'application/x-pkcs7-certreqresp',
								 'application/pkcs7-signature',
								 'application/pkcs8',
								 'text/x-pascal',
								 'application/vnd.pawaafile',
								 'application/vnd.powerbuilder6',
								 'image/x-portable-bitmap',
								 'application/vnd.tcpdump.pcap',
								 'application/x-font-pcf',
								 'application/vnd.hp-pcl',
								 'application/vnd.hp-pclxl',
								 'image/x-pict',
								 'application/vnd.curl.pcurl',
								 'image/x-pcx',
								 'application/vnd.palm',
								 'application/pdf',
								 'application/x-font-type1',
								 'application/x-font-type1',
								 'application/x-font-type1',
								 'application/font-tdpfr',
								 'application/x-pkcs12',
								 'image/x-portable-graymap',
								 'application/x-chess-pgn',
								 'application/pgp-encrypted',
								 'image/x-pict',
								 'application/octet-stream',
								 'application/pkixcmp',
								 'application/pkix-pkipath',
								 'application/vnd.3gpp.pic-bw-large',
								 'application/vnd.mobius.plc',
								 'application/vnd.pocketlearn',
								 'application/pls+xml',
								 'application/vnd.ctc-posml',
								 'image/png',
								 'image/x-portable-anymap',
								 'application/vnd.macports.portpkg',
								 'application/vnd.ms-powerpoint',
								 'application/vnd.ms-powerpoint.template.macroenabled.12',
								 'application/vnd.openxmlformats-officedocument.presentationml.template',
								 'application/vnd.ms-powerpoint.addin.macroenabled.12',
								 'application/vnd.cups-ppd',
								 'image/x-portable-pixmap',
								 'application/vnd.ms-powerpoint',
								 'application/vnd.ms-powerpoint.slideshow.macroenabled.12',
								 'application/vnd.openxmlformats-officedocument.presentationml.slideshow',
								 'application/vnd.ms-powerpoint',
								 'application/vnd.ms-powerpoint.presentation.macroenabled.12',
								 'application/vnd.openxmlformats-officedocument.presentationml.presentation',
								 'application/vnd.palm',
								 'application/x-mobipocket-ebook',
								 'application/vnd.lotus-freelance',
								 'application/pics-rules',
								 'application/postscript',
								 'application/vnd.3gpp.pic-bw-small',
								 'image/vnd.adobe.photoshop',
								 'application/x-font-linux-psf',
								 'application/pskc+xml',
								 'application/vnd.pvi.ptid1',
								 'application/x-mspublisher',
								 'application/vnd.3gpp.pic-bw-var',
								 'application/vnd.3m.post-it-notes',
								 'audio/vnd.ms-playready.media.pya',
								 'video/vnd.ms-playready.media.pyv',
								 'application/vnd.epson.quickanime',
								 'application/vnd.intu.qbo',
								 'application/vnd.intu.qfx',
								 'application/vnd.publishare-delta-tree',
								 'video/quicktime',
								 'application/vnd.quark.quarkxpress',
								 'application/vnd.quark.quarkxpress',
								 'application/vnd.quark.quarkxpress',
								 'application/vnd.quark.quarkxpress',
								 'application/vnd.quark.quarkxpress',
								 'application/vnd.quark.quarkxpress',
								 'audio/x-pn-realaudio',
								 'audio/x-pn-realaudio',
								 'application/x-rar-compressed',
								 'image/x-cmu-raster',
								 'application/vnd.ipunplugged.rcprofile',
								 'application/rdf+xml',
								 'application/vnd.data-vision.rdz',
								 'application/vnd.businessobjects',
								 'application/x-dtbresource+xml',
								 'image/x-rgb',
								 'application/reginfo+xml',
								 'audio/vnd.rip',
								 'application/x-research-info-systems',
								 'application/resource-lists+xml',
								 'image/vnd.fujixerox.edmics-rlc',
								 'application/resource-lists-diff+xml',
								 'application/vnd.rn-realmedia',
								 'audio/midi',
								 'audio/x-pn-realaudio-plugin',
								 'application/vnd.jcp.javame.midlet-rms',
								 'application/vnd.rn-realmedia-vbr',
								 'application/relax-ng-compact-syntax',
								 'application/rpki-roa',
								 'text/troff',
								 'application/vnd.cloanto.rp9',
								 'application/vnd.nokia.radio-presets',
								 'application/vnd.nokia.radio-preset',
								 'application/sparql-query',
								 'application/rls-services+xml',
								 'application/rsd+xml',
								 'application/rss+xml',
								 'text/rtf',
								 'text/richtext',
								 'text/x-asm',
								 'audio/s3m',
								 'application/vnd.yamaha.smaf-audio',
								 'application/sbml+xml',
								 'application/vnd.ibm.secure-container',
								 'application/x-msschedule',
								 'application/vnd.lotus-screencam',
								 'application/scvp-cv-request',
								 'application/scvp-cv-response',
								 'text/vnd.curl.scurl',
								 'application/vnd.stardivision.draw',
								 'application/vnd.stardivision.calc',
								 'application/vnd.stardivision.impress',
								 'application/vnd.solent.sdkm+xml',
								 'application/vnd.solent.sdkm+xml',
								 'application/sdp',
								 'application/vnd.stardivision.writer',
								 'application/vnd.seemail',
								 'application/vnd.fdsn.seed',
								 'application/vnd.sema',
								 'application/vnd.semd',
								 'application/vnd.semf',
								 'application/java-serialized-object',
								 'application/set-payment-initiation',
								 'application/set-registration-initiation',
								 'application/vnd.hydrostatix.sof-data',
								 'application/vnd.spotfire.sfs',
								 'text/x-sfv',
								 'image/sgi',
								 'application/vnd.stardivision.writer-global',
								 'text/sgml',
								 'text/sgml',
								 'application/x-sh',
								 'application/x-shar',
								 'application/shf+xml',
								 'image/x-mrsid-image',
								 'application/pgp-signature',
								 'audio/silk',
								 'model/mesh',
								 'application/vnd.symbian.install',
								 'application/vnd.symbian.install',
								 'application/x-stuffit',
								 'application/x-stuffitx',
								 'application/vnd.koan',
								 'application/vnd.koan',
								 'application/vnd.koan',
								 'application/vnd.koan',
								 'application/vnd.ms-powerpoint.slide.macroenabled.12',
								 'application/vnd.openxmlformats-officedocument.presentationml.slide',
								 'application/vnd.epson.salt',
								 'application/vnd.stepmania.stepchart',
								 'application/vnd.stardivision.math',
								 'application/smil+xml',
								 'application/smil+xml',
								 'video/x-smv',
								 'application/vnd.stepmania.package',
								 'audio/basic',
								 'application/x-font-snf',
								 'application/octet-stream',
								 'application/x-pkcs7-certificates',
								 'application/vnd.yamaha.smaf-phrase',
								 'application/x-futuresplash',
								 'text/vnd.in3d.spot',
								 'application/scvp-vp-response',
								 'application/scvp-vp-request',
								 'audio/ogg',
								 'application/x-sql',
								 'application/x-wais-source',
								 'application/x-subrip',
								 'application/sru+xml',
								 'application/sparql-results+xml',
								 'application/ssdl+xml',
								 'application/vnd.kodak-descriptor',
								 'application/vnd.epson.ssf',
								 'application/ssml+xml',
								 'application/vnd.sailingtracker.track',
								 'application/vnd.sun.xml.calc.template',
								 'application/vnd.sun.xml.draw.template',
								 'application/vnd.wt.stf',
								 'application/vnd.sun.xml.impress.template',
								 'application/hyperstudio',
								 'application/vnd.ms-pki.stl',
								 'application/vnd.pg.format',
								 'application/vnd.sun.xml.writer.template',
								 'text/vnd.dvb.subtitle',
								 'application/vnd.sus-calendar',
								 'application/vnd.sus-calendar',
								 'application/x-sv4cpio',
								 'application/x-sv4crc',
								 'application/vnd.dvb.service',
								 'application/vnd.svd',
								 'image/svg+xml',
								 'image/svg+xml',
								 'application/x-director',
								 'application/x-shockwave-flash',
								 'application/vnd.aristanetworks.swi',
								 'application/vnd.sun.xml.calc',
								 'application/vnd.sun.xml.draw',
								 'application/vnd.sun.xml.writer.global',
								 'application/vnd.sun.xml.impress',
								 'application/vnd.sun.xml.math',
								 'application/vnd.sun.xml.writer',
								 'text/troff',
								 'application/x-t3vm-image',
								 'application/vnd.mynfc',
								 'application/vnd.tao.intent-module-archive',
								 'application/x-tar',
								 'application/vnd.3gpp2.tcap',
								 'application/x-tcl',
								 'application/vnd.smart.teacher',
								 'application/tei+xml',
								 'application/tei+xml',
								 'application/x-tex',
								 'application/x-texinfo',
								 'application/x-texinfo',
								 'text/plain',
								 'application/thraud+xml',
								 'application/x-tex-tfm',
								 'image/x-tga',
								 'application/vnd.ms-officetheme',
								 'image/tiff',
								 'image/tiff',
								 'application/vnd.tmobile-livetv',
								 'application/x-bittorrent',
								 'application/vnd.groove-tool-template',
								 'application/vnd.trid.tpt',
								 'text/troff',
								 'application/vnd.trueapp',
								 'application/x-msterminal',
								 'video/MP2T',
								 'application/timestamped-data',
								 'text/tab-separated-values',
								 'application/x-font-ttf',
								 'application/x-font-ttf',
								 'text/turtle',
								 'application/vnd.simtech-mindmapper',
								 'application/vnd.simtech-mindmapper',
								 'application/vnd.genomatix.tuxedo',
								 'application/vnd.mobius.txf',
								 'text/plain',
								 'application/x-authorware-bin',
								 'application/x-debian-package',
								 'application/vnd.ufdl',
								 'application/vnd.ufdl',
								 'application/x-glulx',
								 'application/vnd.umajin',
								 'application/vnd.unity',
								 'application/vnd.uoml+xml',
								 'text/uri-list',
								 'text/uri-list',
								 'text/uri-list',
								 'application/x-ustar',
								 'application/vnd.uiq.theme',
								 'text/x-uuencode',
								 'audio/vnd.dece.audio',
								 'application/vnd.dece.data',
								 'application/vnd.dece.data',
								 'image/vnd.dece.graphic',
								 'video/vnd.dece.hd',
								 'image/vnd.dece.graphic',
								 'video/vnd.dece.mobile',
								 'video/vnd.dece.pd',
								 'video/vnd.dece.sd',
								 'application/vnd.dece.ttml+xml',
								 'video/vnd.uvvu.mp4',
								 'video/vnd.dece.video',
								 'audio/vnd.dece.audio',
								 'application/vnd.dece.data',
								 'application/vnd.dece.data',
								 'image/vnd.dece.graphic',
								 'video/vnd.dece.hd',
								 'image/vnd.dece.graphic',
								 'video/vnd.dece.mobile',
								 'video/vnd.dece.pd',
								 'video/vnd.dece.sd',
								 'application/vnd.dece.ttml+xml',
								 'video/vnd.uvvu.mp4',
								 'video/vnd.dece.video',
								 'application/vnd.dece.unspecified',
								 'application/vnd.dece.zip',
								 'application/vnd.dece.unspecified',
								 'application/vnd.dece.zip',
								 'text/vcard',
								 'application/x-cdlink',
								 'text/x-vcard',
								 'application/vnd.groove-vcard',
								 'text/x-vcalendar',
								 'application/vnd.vcx',
								 'application/vnd.visionary',
								 'video/vnd.vivo',
								 'video/x-ms-vob',
								 'application/vnd.stardivision.writer',
								 'application/x-authorware-bin',
								 'model/vrml',
								 'application/vnd.visio',
								 'application/vnd.vsf',
								 'application/vnd.visio',
								 'application/vnd.visio',
								 'application/vnd.visio',
								 'text/vtt',
								 'model/vnd.vtu',
								 'application/voicexml+xml',
								 'application/x-director',
								 'application/x-doom',
								 'audio/x-wav',
								 'audio/x-ms-wax',
								 'image/vnd.wap.wbmp',
								 'application/vnd.criticaltools.wbs+xml',
								 'application/vnd.wap.wbxml',
								 'application/vnd.ms-works',
								 'application/vnd.ms-works',
								 'image/vnd.ms-photo',
								 'audio/webm',
								 'application/x-web-app-manifest+json',
								 'video/webm',
								 'image/webp',
								 'application/vnd.pmi.widget',
								 'application/widget',
								 'application/vnd.ms-works',
								 'video/x-ms-wm',
								 'audio/x-ms-wma',
								 'application/x-ms-wmd',
								 'application/x-msmetafile',
								 'text/vnd.wap.wml',
								 'application/vnd.wap.wmlc',
								 'text/vnd.wap.wmlscript',
								 'application/vnd.wap.wmlscriptc',
								 'video/x-ms-wmv',
								 'video/x-ms-wmx',
								 'application/x-msmetafile',
								 'application/x-font-woff',
								 'application/vnd.wordperfect',
								 'application/vnd.ms-wpl',
								 'application/vnd.ms-works',
								 'application/vnd.wqd',
								 'application/x-mswrite',
								 'model/vrml',
								 'application/wsdl+xml',
								 'application/wspolicy+xml',
								 'application/vnd.webturbo',
								 'video/x-ms-wvx',
								 'application/x-authorware-bin',
								 'model/x3d+xml',
								 'model/x3d+binary',
								 'model/x3d+binary',
								 'model/x3d+vrml',
								 'model/x3d+vrml',
								 'model/x3d+xml',
								 'application/xaml+xml',
								 'application/x-silverlight-app',
								 'application/vnd.xara',
								 'application/x-ms-xbap',
								 'application/vnd.fujixerox.docuworks.binder',
								 'image/x-xbitmap',
								 'application/xcap-diff+xml',
								 'application/vnd.syncml.dm+xml',
								 'application/vnd.adobe.xdp+xml',
								 'application/dssc+xml',
								 'application/vnd.fujixerox.docuworks',
								 'application/xenc+xml',
								 'application/patch-ops-error+xml',
								 'application/vnd.adobe.xfdf',
								 'application/vnd.xfdl',
								 'application/xhtml+xml',
								 'application/xhtml+xml',
								 'application/xv+xml',
								 'image/vnd.xiff',
								 'application/vnd.ms-excel',
								 'application/vnd.ms-excel.addin.macroenabled.12',
								 'application/vnd.ms-excel',
								 'application/x-xliff+xml',
								 'application/vnd.ms-excel',
								 'application/vnd.ms-excel',
								 'application/vnd.ms-excel.sheet.binary.macroenabled.12',
								 'application/vnd.ms-excel.sheet.macroenabled.12',
								 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
								 'application/vnd.ms-excel',
								 'application/vnd.ms-excel.template.macroenabled.12',
								 'application/vnd.openxmlformats-officedocument.spreadsheetml.template',
								 'application/vnd.ms-excel',
								 'audio/xm',
								 'application/xml',
								 'application/vnd.olpc-sugar',
								 'application/xop+xml',
								 'application/x-xpinstall',
								 'application/xproc+xml',
								 'image/x-xpixmap',
								 'application/vnd.is-xpr',
								 'application/vnd.ms-xpsdocument',
								 'application/vnd.intercon.formnet',
								 'application/vnd.intercon.formnet',
								 'application/xml',
								 'application/xslt+xml',
								 'application/vnd.syncml+xml',
								 'application/xspf+xml',
								 'application/vnd.mozilla.xul+xml',
								 'application/xv+xml',
								 'application/xv+xml',
								 'image/x-xwindowdump',
								 'chemical/x-xyz',
								 'application/x-xz',
								 'application/yang',
								 'application/yin+xml',
								 'application/x-zmachine',
								 'application/x-zmachine',
								 'application/x-zmachine',
								 'application/x-zmachine',
								 'application/x-zmachine',
								 'application/x-zmachine',
								 'application/x-zmachine',
								 'application/x-zmachine',
								 'application/vnd.zzazz.deck+xml',
								 'application/zip',
								 'application/vnd.zul',
								 'application/vnd.zul',
								 'application/vnd.handheld-entertainment+xml',
								 'image/png');
								 
  protected $_renamed = false;
  protected $_filenames = array();

  
  //Upload Outcome is used to control database so that a link in database is created only if uploaded file is successful
  protected $_uploadOutcome = false;
 
  public function __construct($path) {
	if (!is_dir($path) || !is_writable($path)) {
	  throw new Exception("$path must be a valid, writeable directory.");
	}
	$this->_destination = $path;
	$this->_uploaded = $_FILES;
  }
  
  public function getMaxSize() {
	return number_format($this->_max/1024, 1) . 'kB';
  }
  
  
  public function setMaxSize($num) {
	if (!is_numeric($num)) {
	  throw new Exception("Maximum size must be a number.");
	}
	$this->_max = (int) $num;
  }

  public function move($overwrite = false) {
	$field = current($this->_uploaded);
	if (is_array($field['name'])) {
	  foreach ($field['name'] as $number => $filename) {
		// process multiple upload
		$this->_renamed = false;
		$this->processFile($filename, $field['error'][$number], $field['size'][$number], $field['type'][$number], $field['tmp_name'][$number], $overwrite);	
	  }
	} else {
	  $this->processFile($field['name'], $field['error'], $field['size'], $field['type'], $field['tmp_name'], $overwrite);
	}
  }


   public function getMessages() {
	return $this->_messages;
  }
	
	public function getName() {	
		
		$field = current($this->_uploaded);
		if (is_array($field['name'])) {
		  foreach ($field['name'] as $number => $filename) {
			// process multiple upload
			$this->_renamed = false;
				
		  }
		  return "Two files";
		} else {
			$originalName = $field['name'];
			return $originalName;
		  //$this->processFile($field['name'], $field['error'], $field['size'], $field['type'], $field['tmp_name'], $overwrite);
		}
	
		//$nameTest = $filename;
		//return $nameTest;
	}
	

   public function getError() {
	 return $this->_max;
  }
  //Get function to return protected upload outcome 
	public function getUploadOutcome() {
		return $this->_uploadOutcome;
	}

  protected function checkError($filename, $error) {
	switch ($error) {
	  case 0:
		return true;
	  case 1:
	  case 2:
	    $this->_messages[] = "$filename exceeds maximum size: " . $this->getMaxSize();
	    $this->control_messages = 1;
		return true;
	  case 3:
		$this->_messages[] = "Error uploading $filename. Please try again.";
		$this->control_messages = 1;
		return false;
	  case 4:
		$this->_messages[] = 'No file selected.';
		$this->control_messages = 1;
		return false;
	  default:
		$this->_messages[] = "System error uploading $filename. Contact webmaster.";
		$this->control_messages = 1;
		return false;
	}
  }

  protected function checkSize($filename, $size) {
	if ($size == 0) {
	  return false;
	} elseif ($size > $this->_max) {
	  $this->_messages[] = "$filename exceeds maximum size: " . $this->getMaxSize();
	  return false;
	} else {
	  return true;
	}
  }
  
  protected function checkType($filename, $type) {
	if (empty($type)) {
	  return false;
	} elseif (!in_array($type, $this->_permitted)) {
	  $this->_messages[] = "$filename is not a permitted type of file.";
	  return false;
	} else {
	  return true;
	}
  }

  public function addPermittedTypes($types) {
	$types = (array) $types;
    $this->isValidMime($types);
	$this->_permitted = array_merge($this->_permitted, $types);
  }

	/*Set Mime Type*/
  protected function isValidMime($types) {
    $alsoValid = array( 'image/gif',
						'image/jpeg',
						'image/pjpeg',
						'application/octet-stream',
						'application/zip',
						'application/msword',
						'application/pdf',
						'application/mp21',
						'video/mp4',
						'audio/mp4',
						'application/mp4',
						'application/vnd.mophun.certificate',
						'video/mpeg',
						'audio/mpeg',
						'text/html',
						'image/png'
					   );
  	$valid = array_merge($this->_permitted, $alsoValid);
	foreach ($types as $type) {
	  if (!in_array($type, $valid)) {
		throw new Exception("$type is not a permitted MIME type");
	  }
	}
  }

  protected function checkName($name, $overwrite) {
	$nospaces = str_replace(' ', '_', $name);
	if ($nospaces != $name) {
	  $this->_renamed = true;
	}
	if (!$overwrite) {
	  $existing = scandir($this->_destination);
	  if (in_array($nospaces, $existing)) {
		$dot = strrpos($nospaces, '.');
		if ($dot) {
		  $base = substr($nospaces, 0, $dot);
		  $extension = substr($nospaces, $dot);
		} else {
		  $base = $nospaces;
		  $extension = '';
		}
		$i = 1;
		do {
		  $nospaces = $base . '_' . $i++ . $extension;
		} while (in_array($nospaces, $existing));
		$this->_renamed = true;
	  }
	}
	return $nospaces;
  }

	
    protected function processFile($filename, $error, $size, $type, $tmp_name, $overwrite) {
	$OK = $this->checkError($filename, $error);
	//
	//$this->_filenames[] = $filename;
		//
	if ($OK) {
	  $sizeOK = $this->checkSize($filename, $size);
	  $typeOK = $this->checkType($filename, $type);
	  if ($sizeOK && $typeOK) {

	  
		$name = $this->checkName($filename, $overwrite);

		
 	    $imageTimeStamp = time();
		$name = $imageTimeStamp . $name;

		$success = move_uploaded_file($tmp_name, $this->_destination . $name);

		if ($success) {
	      // add the amended filename to the array of filenames
		$this->_uploadOutcome = true;
	   // $this->_filenames[] = $name;
		$this->_filenames[] = $name;
		
	
			//$message = "$filename uploaded successfully";
		$message = "$name";
		if ($this->_renamed) {
			//  $message = " and renamed $name";
			$message = "$name";   
			//$message = "$filename";
		}
				$this->_messages[] = $message;
		    } else {
				$this->_uploadOutcome = false;
				$this->_messages[] = "Could not upload $filename";
			}
	  }
	}
  }
}